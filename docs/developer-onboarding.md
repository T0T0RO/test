# Developer Onboarding Guide

This guide explains how to work with the MF2 (Micro Frontend Federation v2) system **per team and per app**.

It assumes you are familiar with Node, npm, and the basic framework you are working on (Angular, React, Vue, or Vite).

---

## 0. Prerequisites

- Node and npm installed
- `npm install` has been run at the repo root and in each app as needed
- Basic understanding of:
  - how Vite dev servers work
  - how Angular CLI works
  - how to read package.json scripts

---

## 1. Integration Layer + Shell Team

### 1.1 Key Folders

```text
integration-layer/
  remote-configs/mfe.config.json
  scripts/
    build-remotes.mjs
    generate-remote-entry.mjs
    generate-remote-manifest.mjs
  dist/
    remote-manifest.js
  shell/
    vite.config.ts
    src/
      remote-manifest.js
      runtime/remoteLoader.ts
      main.ts
```

### 1.2 Core Responsibilities

- Maintain `mfe.config.json` as the single source of truth for remotes.
- Keep integration scripts (`*.mjs`) aligned with this config.
- Ensure the shell can:
  - list available remotes
  - mount/unmount them via the MF2 contract
- Add new remotes by editing only the integration-layer and shell — never remote `src` code.

### 1.3 Common Commands

From repo root:

```bash
# Build all remotes (using their configured commands)
npm run -C ./integration-layer build:remotes

# Generate bootstrap bundles + remoteEntry.js for each remote
npm run -C ./integration-layer gen:entries

# Create manifest and copy it into shell
npm run -C ./integration-layer gen:manifest

# Build everything in one go
npm run -C ./integration-layer refresh:all:build

# Start shell in dev mode (runs a quick manifest refresh first)
npm run -C ./integration-layer dev:shell
```

Then open:

```text
http://localhost:5173/
```

You should see the shell UI with buttons for each remote.

### 1.4 Adding a New Remote

1. Ensure the new remote app has:
   - a `bootstrap.ts` or `bootstrap.tsx` file exporting `bootstrap` and `teardown`
   - a `build` script in its package.json, or a documented framework-specific build plan
2. Add a new entry in `integration-layer/remote-configs/mfe.config.json`:
   ```jsonc
   {
     "name": "my-remote",
     "framework": "react",
     "root": "../path/to/my-remote",
     "bootstrap": "src/bootstrap.tsx",
     "enabled": true
   }
   ```
3. Run:
   ```bash
   npm run -C ./integration-layer refresh:all:build
   npm run -C ./integration-layer dev:shell
   ```
4. Confirm you see `my-remote` in the shell and it mounts correctly.

---

## 2. Angular Remotes (app1, app2)

Location:

```text
simple_angular_app/app1/
simple_angular_app/app2/
```

### 2.1 Team Local Dev (Normal Angular App)

This is for the Angular team to work on the app as a standalone SPA.

From inside each app folder (`app1` / `app2`):

```bash
# Install deps (first time)
npm install

# Run dev server
npm start        # typically an alias for "ng serve"

# Standard build (non-MF2)
npm run build
```

This path uses the standard Angular entry:

- `src/main.ts`
- `src/index.html`

### 2.2 MF2 Build (Used by Integration Layer)

For MF2, Angular uses a dedicated build configuration in `angular.json`, with:

- `browser: "src/main.mf2.ts"`
- `index: "src/index.mf2.html"`

For each Angular remote, you have:

```bash
# Build for MF2 integration
npm run build:mf2      # internally -> ng build --configuration=mf2
```

This is what the integration-layer uses when it calls `build-remotes.mjs` for Angular remotes.

### 2.3 Angular MF2 Files (Per App)

Each Angular MF2 remote uses:

- `src/bootstrap.ts` – MF2 runtime bootstrap/teardown
- `src/main.mf2.ts` – neutral build entry (no document bootstrap)
- `src/index.mf2.html` – simple HTML shell
- `angular.json` – `build.configurations.mf2`

At runtime, the shell calls into the **built** bootstrap at:

```text
dist/_mf2/bootstrap.mjs          # generated by generate-remote-entry.mjs
```

which in turn mounts Angular via the `bootstrap` function.

### 2.4 Adding a New Angular Remote

1. Scaffold it like `app1` / `app2` (Angular 20, standalone APIs).
2. Add:
   - `src/bootstrap.ts`
   - `src/main.mf2.ts`
   - `src/index.mf2.html`
   - a `build:mf2` script in package.json that runs `ng build --configuration=mf2`
3. Create an `mf2` build configuration in `angular.json` similar to existing apps.
4. Register it in `mfe.config.json` with `"framework": "angular"`.
5. Run the integration-layer commands to verify.

---

## 3. React Remote (app-react)

Location:

```text
simple_react_app/app-react/
```

### 3.1 Team Local Dev

From `simple_react_app/app-react`:

```bash
npm install          # first time
npm run dev          # or equivalent, depending on package.json
```

(If there is no `dev` script, check `package.json` for the dev entry; this repo uses `vite` so the script might be `vite` or `vite dev`.)

### 3.2 React MF2 Build

The integration-layer expects the React remote to:

- have a `bootstrap.tsx` that exports `bootstrap(container)` and `teardown()`
- support a `build` script that runs `tsc -b && vite build` (as configured)

From `app-react`:

```bash
npm run build
```

The MF2 integration layer will:

- bundle `src/bootstrap.tsx` into `dist/_mf2/bootstrap.mjs`
- generate `dist/remoteEntry.js`

You do not need a custom configuration like Angular’s `mf2` mode; the standard build is enough.

---

## 4. Vue Remote (app-vue)

Location:

```text
simple_vue_app/app-vue/
```

### 4.1 Team Local Dev

From `simple_vue_app/app-vue`:

```bash
npm install
npm run dev          # or the equivalent Vue/Vite dev script
```

### 4.2 Vue MF2 Build

The integration-layer expects:

- `src/bootstrap.ts` with `bootstrap(container)` and `teardown(container)`
- a `build` script that runs `vue-tsc -b && vite build`

Build:

```bash
npm run build
```

Integration-layer will then:

- bundle `src/bootstrap.ts` to `dist/_mf2/bootstrap.mjs`
- generate `dist/remoteEntry.js`

---

## 5. Vanilla Vite Remote (app-vite-vanilla)

Location:

```text
simple_vite_app/app-vite-vanilla/
```

### 5.1 Team Local Dev

From `simple_vite_app/app-vite-vanilla`:

```bash
npm install
npm run dev          # typical Vite dev script, check package.json
```

### 5.2 Vanilla MF2 Build

Integration expects:

- `src/bootstrap.ts` with DOM-based `bootstrap` and `teardown`
- a `build` script that runs `tsc && vite build`

Build:

```bash
npm run build
```

MF2 scripts will generate `dist/_mf2/bootstrap.mjs` and `dist/remoteEntry.js` exactly as for other frameworks.

---

## 6. Adding / Modifying Remotes Safely

When you modify or add remotes, keep these rules in mind:

1. **Do not change integration-layer scripts from a remote.**
   - Integration-layer is owned by the platform team.
   - Remotes are owned by feature/framework teams.

2. **Do not import remote `src` from the shell or integration-layer.**
   - All communication uses `remoteEntry.js` in `dist`.

3. **Do not use ts-node or runtime TypeScript.**
   - All scripts in `integration-layer/scripts` must be plain Node ESM.

4. **Keep MF2 bootstrap simple.**
   - `bootstrap(container)` should mount into the given container only.
   - `teardown(container)` should remove what `bootstrap` created and free resources.

5. **Angular-specific: keep the dual world separate.**
   - Normal app: `main.ts` + `index.html` for team dev.
   - MF2 integration: `bootstrap.ts` + `main.mf2.ts` + `index.mf2.html` for the shell.

---

## 7. Troubleshooting Checklist

If a remote does not show up or does not mount correctly, check in this order:

1. **Manifest**
   - `integration-layer/dist/remote-manifest.js` has your remote listed.
   - `integration-layer/shell/src/remote-manifest.js` is up to date.

2. **Paths**
   - Manifest `entry` path points to `/remotes/<name>/remoteEntry.js`.
   - Shell Vite config has alias / static mapping for that remote’s `dist` folder.

3. **Build Output**
   - The remote’s `dist` folder contains `remoteEntry.js` and `_mf2/bootstrap.mjs`.

4. **Remote Contract**
   - `remoteEntry.js` exports `mount` and `unmount` functions.
   - `bootstrap.mjs` exports `bootstrap` and `teardown` (or compatible names wired up by the generator).

5. **Angular-specific**
   - `ng build --configuration=mf2` succeeds.
   - MF2 build uses `main.mf2.ts` and `index.mf2.html`.
   - There is no global `bootstrapApplication` in MF2 entry files.

---

## 8. Summary

- Integration-layer + shell team manages orchestration, manifests, and shell runtime.
- Each framework team (Angular/React/Vue/Vanilla) owns their app, its dev server setup, and its MF2 bootstrap.
- The only strong contract between them is:
  - each remote builds a `remoteEntry.js`
  - that entry exposes `mount`/`unmount`
  - integration-layer only talks to built artifacts, never to `src` code.

Work per-app with your familiar framework tools, then use the integration-layer commands to see everything working together in the shell.
